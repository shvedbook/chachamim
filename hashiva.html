<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>סימולטור מבחנים פסיכוטכניים</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Assistant', sans-serif;
        }
        .option-btn {
            transition: all 0.2s ease-in-out;
        }
        .option-btn.selected {
            background-color: #3b82f6; /* bg-blue-600 */
            color: white;
            border-color: #3b82f6;
        }
        .option-btn.correct {
            background-color: #16a34a; /* bg-green-600 */
            color: white;
            border-color: #16a34a;
        }
        .option-btn.incorrect {
            background-color: #dc2626; /* bg-red-600 */
            color: white;
            border-color: #dc2626;
        }
        .shape {
            width: 40px;
            height: 40px;
        }
        .shape.circle {
            border-radius: 50%;
        }
        .shape.triangle {
            width: 0;
            height: 0;
            background-color: transparent !important;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom-width: 40px;
            border-bottom-style: solid;
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <div id="app" class="w-full max-w-3xl mx-auto">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="bg-white p-8 rounded-2xl shadow-lg text-center">
            <h1 class="text-3xl font-bold text-slate-800 mb-4">סימולטור מבחנים פסיכוטכניים</h1>
            <p class="text-slate-600 mb-8">
                כאן תוכלי לתרגל את שלושת סוגי המבחנים העיקריים: מילולי, כמותי וצורני.<br>בחרי את התחום שברצונך לתרגל.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button data-category="verbal" class="category-btn bg-blue-500 text-white font-bold p-6 rounded-lg hover:bg-blue-600 transition-colors duration-300 shadow-md">
                    <span class="text-2xl">📝</span>
                    <h3 class="mt-2 text-xl font-semibold">חשיבה מילולית</h3>
                    <p class="text-sm font-light mt-1">אנלוגיות, לוגיקה והשלמת משפטים</p>
                </button>
                <button data-category="quantitative" class="category-btn bg-green-500 text-white font-bold p-6 rounded-lg hover:bg-green-600 transition-colors duration-300 shadow-md">
                    <span class="text-2xl">🧮</span>
                    <h3 class="mt-2 text-xl font-semibold">חשיבה כמותית</h3>
                    <p class="text-sm font-light mt-1">סדרות חשבוניות ובעיות מתמטיות</p>
                </button>
                <button data-category="figural" class="category-btn bg-purple-500 text-white font-bold p-6 rounded-lg hover:bg-purple-600 transition-colors duration-300 shadow-md">
                    <span class="text-2xl">🎨</span>
                    <h3 class="mt-2 text-xl font-semibold">חשיבה צורנית</h3>
                    <p class="text-sm font-light mt-1">סדרות של צורות ומטריצות</p>
                </button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
                 <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-semibold text-slate-500">שאלה <span id="question-number"></span> מתוך <span id="total-questions"></span></span>
                        <span id="quiz-category" class="text-sm font-bold"></span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-2.5">
                        <div id="progress-bar" class="h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                
                <div id="question-area" class="bg-slate-50 p-6 rounded-lg mb-6 min-h-[120px] flex items-center justify-center">
                    <!-- Question content will be rendered here -->
                </div>
                
                <div id="options-area" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Options will be injected here by JS -->
                </div>

                <div class="mt-8 flex justify-between items-center">
                    <button id="back-to-menu-btn" class="text-sm text-slate-500 hover:text-slate-700">חזרה לתפריט</button>
                    <button id="next-btn" class="bg-slate-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-slate-700 transition-colors duration-300 disabled:bg-slate-400 disabled:cursor-not-allowed" disabled>
                        הבא
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden">
             <div class="bg-white p-8 rounded-2xl shadow-lg">
                <h2 class="text-3xl font-bold text-slate-800 mb-2 text-center">סיכום התרגול</h2>
                <div class="text-center mb-6 p-4 bg-slate-50 rounded-xl">
                    <p class="text-lg text-slate-600">הצלחת ב-</p>
                    <p id="score-display" class="text-6xl font-bold text-blue-600">0/0</p>
                    <p id="score-percentage" class="text-xl font-semibold text-slate-700"></p>
                </div>
                
                <h3 class="text-xl font-bold text-slate-800 mb-4">פירוט תשובות:</h3>
                <div id="answers-review-container" class="space-y-4 max-h-80 overflow-y-auto pr-2">
                    <!-- Review will be injected here -->
                </div>

                <div class="mt-8 flex justify-center gap-4">
                    <button id="restart-quiz-btn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300 shadow-md">
                        תרגול נוסף באותו נושא
                    </button>
                     <button id="main-menu-btn" class="bg-slate-200 text-slate-800 font-bold py-3 px-6 rounded-lg hover:bg-slate-300 transition-colors duration-300">
                        לתפריט הראשי
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const app = {
            questions: {
                verbal: [
                    { type: 'analogy', question: "מכונית : הגה", options: ["ספינה : משוט", "מטוס : כנף", "רכבת : קטר", "אופניים : כידון"], answer: 3, explanation: "ההגה משמש להיגוי המכונית, כשם שהכידון משמש להיגוי האופניים." },
                    { type: 'logic', question: "כל הג'ירפות גבוהות. ג'ורג' הוא ג'ירפה. מה ניתן להסיק?", options: ["ג'ורג' נמוך", "ג'ורג' גבוה", "כל החיות הגבוהות הן ג'ירפות", "לא ניתן להסיק דבר"], answer: 1, explanation: "אם כל הג'ירפות גבוהות, וג'ורג' הוא ג'ירפה, אז בהכרח ג'ורג' גבוה." },
                    { type: 'completion', question: "למרות שהיה עייף, הוא ___ להמשיך לעבוד כדי ___ את הפרויקט בזמן.", options: ["סירב, לסיים", "החליט, לסיים", "שכח, להתחיל", "רצה, לעכב"], answer: 1, explanation: "המילה 'למרות' מצביעה על ניגוד. למרות העייפות, הוא בחר להמשיך לעבוד כדי להשיג את המטרה - סיום הפרויקט." },
                    { type: 'analogy', question: "רעב : אוכל", options: ["צמא : שתייה", "עייפות : שינה", "קור : חימום", "כל התשובות נכונות"], answer: 3, explanation: "רעב הוא צורך שאוכל מספק. כל אחת מהאפשרויות האחרות מציגה צורך והמענה לו." },
                    { type: 'analogy', question: "נגר : עץ", options: ["אופה : קמח", "חייט : מספריים", "צייר : צבע", "רופא : תרופה"], answer: 0, explanation: "נגר הוא בעל מקצוע שעובד עם חומר הגלם עץ, כשם שאופה עובד עם חומר הגלם קמח." },
                    { type: 'analogy', question: "מטוס : טייס", options: ["מונית : נוסע", "אונייה : רב חובל", "רכבת : קרון", "מכונית : כביש"], answer: 1, explanation: "טייס מפעיל ומנווט מטוס, כשם שרב חובל מפעיל ומנווט אונייה." },
                    { type: 'logic', question: "אם יורד גשם, המדרכה רטובה. המדרכה יבשה. מהי המסקנה הלוגית?", options: ["יורד גשם", "ירד גשם קודם", "לא יורד גשם", "אי אפשר לדעת"], answer: 2, explanation: "הכלל הוא גשם -> רטוב. אם התוצאה (רטוב) לא מתקיימת, אז גם הסיבה (גשם) לא מתקיימת." },
                    { type: 'logic', question: "כל הפירות מתוקים. תפוח הוא פרי. מה מהבאים נכון בהכרח?", options: ["יש פירות חמוצים", "תפוח הוא מתוק", "כל דבר מתוק הוא פרי", "תפוחים הם תמיד אדומים"], answer: 1, explanation: "אם תפוח שייך לקבוצת הפירות, והקבוצה כולה מתוקה, אז גם התפוח מתוק." },
                    { type: 'completion', question: "בניגוד לציפיות, הסרט היה ___ ואף גרם לחלק מהקהל ___ באמצע.", options: ["מרתק, להריע", "מפתיע, להשתעמם", "משעמם, לעזוב", "מצחיק, לבכות"], answer: 2, explanation: "הביטוי 'בניגוד לציפיות' מרמז על תוצאה שלילית, והצמד 'משעמם' ו'לעזוב' מתאים להקשר זה." },
                    { type: 'analogy', question: "ספר : ספריה", options: ["מנה : מסעדה", "ציור : מוזיאון", "שחקן : במה", "מורה : כיתה"], answer: 1, explanation: "ספריה היא המקום בו מאחסנים ומציגים ספרים, כשם שמוזיאון הוא המקום בו מאחסנים ומציגים ציורים." },
                    { type: 'logic', question: "נתון: יש אנשים גבוהים שאוהבים כדורסל. יוסי אוהב כדורסל. מה ניתן להסיק?", options: ["יוסי גבוה", "יוסי אינו גבוה", "כל מי שאוהב כדורסל הוא גבוה", "לא ניתן להסיק אם יוסי גבוה"], answer: 3, explanation: "העובדה שיוסי אוהב כדורסל לא אומרת שהוא בהכרח שייך לקבוצת הגבוהים שאוהבים כדורסל. ייתכן והוא נמוך ואוהב כדורסל." },
                    { type: 'completion', question: "כדי ___ במשימה המורכבת, על הצוות ___ ולשתף פעולה.", options: ["להיכשל, להתווכח", "להצליח, להתאחד", "לוותר, להתפזר", "לדחות, לחכות"], answer: 1, explanation: "הצלחה במשימה מורכבת דורשת התאחדות ושיתוף פעולה." },
                    { type: 'analogy', question: "אריה : טרף", options: ["פרה : עשב", "דג : ים", "ציפור : שמיים", "אדם : בית"], answer: 0, explanation: "הטרף הוא המזון של האריה, כשם שהעשב הוא המזון של הפרה." },
                    { type: 'completion', question: "המרצה דיבר בצורה ___ כל כך, עד שאפילו הסטודנטים המתקשים ___ את החומר.", options: ["מסובכת, ויתרו על", "מהירה, התעייפו מלנסות", "בהירה, הבינו", "שקטה, לא שמעו"], answer: 2, explanation: "הקשר בין דיבור בהיר להבנת החומר הוא קשר ישיר וחיובי." },
                    { type: 'analogy', question: "ירח : לילה", options: ["שמש : יום", "כוכב : חלל", "ענן : שמיים", "אור : חושך"], answer: 0, explanation: "הירח מאפיין את הלילה כשם שהשמש מאפיינת את היום." },
                    { type: 'logic', question: "רק אנשים אמיצים קופצים ממטוסים. דני קפץ ממטוס. מה נכון?", options: ["דני אינו אמיץ", "כל האמיצים קופצים ממטוסים", "דני אמיץ", "אי אפשר לדעת"], answer: 2, explanation: "המשפט קובע שרק אמיצים קופצים, ומכיוון שדני קפץ, הוא בהכרח אמיץ." },
                    { type: 'completion', question: "הסופה הייתה כה ___ , עד שגגות רבים ___ ברוח.", options: ["חזקה, נעקרו", "חלשה, תוקנו", "נעימה, נבנו", "קצרה, נצבעו"], answer: 0, explanation: "הקשר הלוגי הוא בין סופה חזקה לבין נזק כמו עקירת גגות." },
                    { type: 'analogy', question: "זרע : צמח", options: ["ביצה : תרנגולת", "נהר : ים", "ענף : עץ", "שורש : אדמה"], answer: 0, explanation: "זרע הוא השלב ההתחלתי שממנו מתפתח צמח, כשם שביצה היא השלב ההתחלתי שממנו מתפתחת תרנגולת." },
                    { type: 'logic', question: "אם חולצה היא כחולה, היא לא אדומה. החולצה אינה אדומה. מה ניתן להסיק?", options: ["החולצה כחולה", "החולצה לבנה", "החולצה אינה כחולה", "לא ניתן להסיק בוודאות שהחולצה כחולה"], answer: 3, explanation: "העובדה שהחולצה אינה אדומה לא מחייבת שהיא תהיה כחולה. היא יכולה להיות בכל צבע אחר שאינו אדום." },
                    { type: 'completion', question: "הוא ___ לדחות את הפגישה, ___ שהבין כי לא יספיק להגיע בזמן.", options: ["שמח, לפני", "הצטער, למרות", "נאלץ, לאחר", "העדיף, מפני"], answer: 2, explanation: "הוא נאלץ לבצע פעולה (לדחות) כתוצאה מהבנה מסוימת (שלא יספיק)." },
                    { type: 'analogy', question: "זיכרון : עבר", options: ["תקווה : עתיד", "מחשבה : הווה", "חלום : שינה", "דאגה : בעיה"], answer: 0, explanation: "זיכרון מתייחס לאירועים מהעבר, כשם שתקווה מתייחסת לאירועים מהעתיד." },
                    { type: 'logic', question: "כל הספורטאים בריאים. משה אינו בריא. מה נכון?", options: ["משה ספורטאי", "משה אינו ספורטאי", "יש ספורטאים שאינם בריאים", "כל הבריאים הם ספורטאים"], answer: 1, explanation: "אם משה אינו עונה על התנאי 'בריא' שנדרש מכל הספורטאים, הוא אינו יכול להיות ספורטאי." },
                    { type: 'completion', question: "ההצגה זכתה לביקורות ___ , והקהל ___ את האולם עד אפס מקום.", options: ["גרועות, רוקן", "נלהבות, מילא", "פושרות, עזב", "טובות, פינה"], answer: 1, explanation: "ביקורות נלהבות מובילות בדרך כלל לכך שהקהל ממלא את האולם." },
                    { type: 'analogy', question: "מפתח : דלת", options: ["סיסמה : כספת", "שלט : טלוויזיה", "כסף : ארנק", "ספר : מדף"], answer: 0, explanation: "מפתח משמש לפתיחת דלת נעולה, כשם שסיסמה משמשת לפתיחת כספת נעולה." },
                ],
                quantitative: [
                    { type: 'series', question: "2, 4, 8, 16, ?", options: ["24", "32", "36", "64"], answer: 1, explanation: "הסדרה היא סדרה הנדסית שבה כל איבר מוכפל ב-2." },
                    { type: 'problem', question: "מחיר חולצה הוא 80 שקלים. ניתנה הנחה של 20%. מהו מחיר החולצה לאחר ההנחה?", options: ["60 שקלים", "64 שקלים", "70 שקלים", "72 שקלים"], answer: 1, explanation: "20% מ-80 הם 16 (80 * 0.20). מחיר החולצה לאחר הנחה הוא 80 - 16 = 64." },
                    { type: 'series', question: "1, 1, 2, 3, 5, 8, ?", options: ["11", "12", "13", "15"], answer: 2, explanation: "זוהי סדרת פיבונאצ'י, שבה כל מספר הוא סכום שני המספרים שלפניו. 5 + 8 = 13." },
                    { type: 'problem', question: "רכבת נוסעת במהירות 90 קמ''ש. כמה זמן ייקח לה לעבור מרחק של 45 ק''מ?", options: ["20 דקות", "30 דקות", "45 דקות", "60 דקות"], answer: 1, explanation: "זמן = דרך / מהירות. 45 ק''מ / 90 קמ''ש = 0.5 שעות, שהן 30 דקות." },
                    { type: 'series', question: "1, 4, 9, 16, 25, ?", options: ["32", "35", "36", "40"], answer: 2, explanation: "זו סדרת המספרים הריבועיים (1*1, 2*2, 3*3 וכן הלאה). המספר הבא הוא 6*6 = 36." },
                    { type: 'series', question: "50, 45, 40, 35, ?", options: ["25", "30", "32", "20"], answer: 1, explanation: "הסדרה היא סדרה חשבונית בה ההפרש בין כל שני איברים הוא 5-." },
                    { type: 'problem', question: "אדם קנה 5 עפרונות ב-2 שקלים כל אחד ו-3 מחברות ב-7 שקלים כל אחת. כמה שילם בסך הכל?", options: ["25 שקלים", "29 שקלים", "31 שקלים", "35 שקלים"], answer: 2, explanation: "חישוב העלות: (5 * 2) + (3 * 7) = 10 + 21 = 31." },
                    { type: 'problem', question: "אם 3 עובדים בונים קיר ב-9 ימים, כמה זמן ייקח לעובד אחד לבנות את אותו הקיר לבדו?", options: ["3 ימים", "9 ימים", "18 ימים", "27 ימים"], answer: 3, explanation: "זהו יחס הפוך. פי 3 פחות עובדים יקח פי 3 יותר זמן. 3 * 9 = 27 ימים." },
                    { type: 'problem', question: "רכב נסע 150 ק''מ ב-3 שעות. מה הייתה מהירותו הממוצעת בקמ''ש?", options: ["45 קמ''ש", "50 קמ''ש", "60 קמ''ש", "75 קמ''ש"], answer: 1, explanation: "מהירות = דרך / זמן. 150 ק''מ / 3 שעות = 50 קמ''ש." },
                    { type: 'series', question: "100, 99, 97, 94, 90, ?", options: ["85", "86", "84", "88"], answer: 0, explanation: "ההפרשים בין האיברים גדלים ב-1 בכל פעם: -1, -2, -3, -4. הפעולה הבאה היא 5-. 90 - 5 = 85." },
                    { type: 'problem', question: "שמלה עולה 1200 ש''ח. בחנות יש הנחה של 25%. כמה תעלה השמלה לאחר ההנחה?", options: ["800 ש''ח", "850 ש''ח", "900 ש''ח", "950 ש''ח"], answer: 2, explanation: "25% הם רבע. רבע מ-1200 הוא 300. 1200 - 300 = 900." },
                    { type: 'problem', question: "בכיתה 30 תלמידים. 60% מהם בנות. כמה בנים יש בכיתה?", options: ["10", "12", "15", "18"], answer: 1, explanation: "אם 60% הן בנות, אז 40% הם בנים. 40% מ-30 הם 12 (30 * 0.4)." },
                    { type: 'series', question: "2, 5, 11, 23, ?", options: ["46", "47", "42", "35"], answer: 1, explanation: "החוקיות היא הכפלה ב-2 והוספת 1. 23 * 2 + 1 = 47." },
                    { type: 'problem', question: "יוסי קורא ספר בקצב של 15 עמודים בשעה. בספר יש 180 עמודים. תוך כמה שעות יסיים לקרוא את הספר?", options: ["10 שעות", "11 שעות", "12 שעות", "15 שעות"], answer: 2, explanation: "זמן = כמות / קצב. 180 עמודים / 15 עמודים בשעה = 12 שעות." },
                    { type: 'series', question: "3, 4, 6, 9, 13, ?", options: ["18", "17", "16", "19"], answer: 0, explanation: "הסדרה עולה בסדר עולה: +1, +2, +3, +4. המספר הבא יהיה +5, כלומר 13+5=18." },
                    { type: 'problem', question: "בארגז יש 24 פירות. 1/3 מהם תפוחים ו-1/4 מהם אגסים. כמה פירות אינם תפוחים או אגסים?", options: ["10", "12", "14", "8"], answer: 0, explanation: "מספר התפוחים: 24/3=8. מספר האגסים: 24/4=6. סה''כ תפוחים ואגסים: 8+6=14. שאר הפירות: 24-14=10." },
                    { type: 'series', question: "90, 88, 84, 78, 70, ?", options: ["60", "62", "58", "64"], answer: 0, explanation: "ההפרש יורד וגדל ב-2 בכל פעם: -2, -4, -6, -8. הפעולה הבאה היא 10-. 70-10=60." },
                    { type: 'problem', question: "עלות שיחה בטלפון היא 0.5 ש''ח לדקה. כמה תעלה שיחה של שעה ורבע?", options: ["37.5 ש''ח", "30 ש''ח", "45 ש''ח", "32.5 ש''ח"], answer: 0, explanation: "שעה ורבע הן 75 דקות. 75 * 0.5 = 37.5 ש''ח." },
                    { type: 'series', question: "1, 2, 4, 7, 11, 16, ?", options: ["20", "21", "22", "23"], answer: 2, explanation: "ההפרש בין המספרים גדל ב-1 בכל פעם: +1, +2, +3, +4, +5. הפעולה הבאה היא +6. 16+6=22." },
                    { type: 'problem', question: "כמה הם 15% מ-300?", options: ["30", "45", "50", "60"], answer: 1, explanation: "10% מ-300 הם 30. 5% הם חצי מזה, כלומר 15. ביחד 30+15=45. (או 300 * 0.15)." },
                    { type: 'series', question: "128, 64, 32, 16, ?", options: ["10", "4", "6", "8"], answer: 3, explanation: "זוהי סדרה הנדסית שבה כל איבר הוא חצי מהאיבר שלפניו. 16/2=8." },
                    { type: 'problem', question: "מכונית צורכת ליטר דלק לכל 12 ק''מ. כמה ליטרים תצרוך לנסיעה של 180 ק''מ?", options: ["12 ליטר", "15 ליטר", "18 ליטר", "20 ליטר"], answer: 1, explanation: "מחלקים את סך המרחק בצריכה לק''מ: 180 / 12 = 15 ליטרים." },
                    { type: 'series', question: "4, 9, 19, 39, 79, ?", options: ["159", "149", "169", "139"], answer: 0, explanation: "החוקיות היא הכפלה ב-2 והוספת 1. 79 * 2 + 1 = 158 + 1 = 159." },
                    { type: 'problem', question: "סכום הגילים של דן ודנה הוא 40. דן מבוגר מדנה ב-10 שנים. בת כמה דנה?", options: ["10", "15", "20", "25"], answer: 1, explanation: "אם נוריד את פער הגילים מהסכום (40-10=30), ונחלק ב-2, נקבל את גילה של דנה (30/2=15). דנה בת 15 ודן בן 25." },
                ],
                figural: [
                    { type: 'series', question: [ {shape: 'square', color: 'blue'}, {shape: 'circle', color: 'red'}, {shape: 'square', color: 'blue'} ], options: [ [{shape: 'circle', color: 'red'}], [{shape: 'square', color: 'red'}], [{shape: 'circle', color: 'blue'}], [{shape: 'triangle', color: 'blue'}] ], answer: 0, explanation: "הסדרה מורכבת מריבוע כחול ועיגול אדום לסירוגין." },
                    { type: 'matrix', question: [ {shape: 'triangle', color: 'green'}, {shape: 'triangle', color: 'green'}, {shape: 'triangle', color: 'green'}, {shape: 'square', color: 'yellow'}, {shape: 'square', color: 'yellow'}, '?', ], options: [ [{shape: 'square', color: 'yellow'}], [{shape: 'triangle', color: 'yellow'}], [{shape: 'square', color: 'green'}], [{shape: 'circle', color: 'yellow'}] ], answer: 0, explanation: "השורה הראשונה מורכבת ממשולשים ירוקים, והשורה השנייה מריבועים צהובים." },
                    { type: 'series', question: [ {shape: 'circle', color: 'purple'}, {shape: 'circle', color: 'purple', inner: {shape: 'square', color: 'white'}}, {shape: 'circle', color: 'purple'} ], options: [ [{shape: 'circle', color: 'purple', inner: {shape: 'square', color: 'white'}}], [{shape: 'square', color: 'purple'}], [{shape: 'circle', color: 'white'}], [{shape: 'circle', color: 'purple'}] ], answer: 0, explanation: "הסדרה מציגה לסירוגין עיגול סגול ריק, ועיגול סגול עם ריבוע לבן פנימי." },
                    { type: 'series', question: [ {shape: 'square', color: 'black'}, {shape: 'square', color: 'white'}, {shape: 'square', color: 'black'} ], options: [ [{shape: 'square', color: 'white'}], [{shape: 'square', color: 'black'}], [{shape: 'circle', color: 'white'}], [{shape: 'circle', color: 'black'}] ], answer: 0, explanation: "הסדרה מציגה ריבוע שצבעו מתחלף בין שחור ללבן. הצורה הבאה תהיה ריבוע לבן." },
                    { type: 'series', question: [ {shape: 'triangle', color: 'green'}, {shape: 'square', color: 'green'}, {shape: 'circle', color: 'green'}, {shape: 'triangle', color: 'green'} ], options: [ [{shape: 'square', color: 'blue'}], [{shape: 'circle', color: 'green'}], [{shape: 'square', color: 'green'}], [{shape: 'triangle', color: 'red'}] ], answer: 2, explanation: "הסדרה חוזרת על רצף הצורות: משולש, ריבוע, עיגול. אחרי המשולש יבוא ריבוע." },
                    { type: 'matrix', question: [ {shape: 'square', color: 'red'}, {shape: 'circle', color: 'red'}, {shape: 'square', color: 'blue'}, '?' ], options: [ [{shape: 'circle', color: 'blue'}], [{shape: 'square', color: 'red'}], [{shape: 'circle', color: 'red'}], [{shape: 'triangle', color: 'blue'}] ], answer: 0, explanation: "בכל שורה יש ריבוע ועיגול באותו הצבע. בשורה התחתונה יש ריבוע כחול, ולכן הצורה החסרה היא עיגול כחול." },
                    { type: 'series', question: [ {shape: 'circle', color: 'yellow'}, {shape: 'circle', color: 'yellow'}, {shape: 'triangle', color: 'purple'}, {shape: 'triangle', color: 'purple'}, '?' ], options: [ [{shape: 'square', color: 'yellow'}], [{shape: 'circle', color: 'yellow'}], [{shape: 'triangle', color: 'purple'}], [{shape: 'circle', color: 'purple'}] ], answer: 1, explanation: "החוקיות היא הצגת כל צורה פעמיים ברציפות (זוגות). אחרי זוג משולשים, יתחיל זוג חדש של עיגולים." },
                    { type: 'series', question: [ {shape: 'square', color: 'blue', inner: {shape: 'circle', color: 'white'}}, {shape: 'square', color: 'blue'}, {shape: 'square', color: 'blue', inner: {shape: 'circle', color: 'white'}} ], options: [ [{shape: 'circle', color: 'blue'}], [{shape: 'square', color: 'white'}], [{shape: 'square', color: 'blue'}], [{shape: 'square', color: 'blue', inner: {shape: 'circle', color: 'white'}}] ], answer: 2, explanation: "הצורה הפנימית (עיגול לבן) מופיעה ונעלמת לסירוגין. אחרי שהופיעה, היא תיעלם והריבוע יישאר ריק." },
                    { type: 'series', question: [ {shape: 'triangle', color: 'red'}, {shape: 'square', color: 'blue'}, {shape: 'triangle', color: 'red'} ], options: [ [{shape: 'triangle', color: 'blue'}], [{shape: 'square', color: 'red'}], [{shape: 'square', color: 'blue'}], [{shape: 'circle', color: 'red'}] ], answer: 2, explanation: "הסדרה מורכבת ממשולש אדום וריבוע כחול לסירוגין. אחרי המשולש האדום יבוא ריבוע כחול." },
                    { type: 'matrix', question: [ {shape: 'circle', color: 'green'}, {shape: 'circle', color: 'blue'}, {shape: 'square', color: 'green'}, '?' ], options: [ [{shape: 'triangle', color: 'green'}], [{shape: 'square', color: 'blue'}], [{shape: 'circle', color: 'green'}], [{shape: 'square', color: 'green'}] ], answer: 1, explanation: "בכל עמודה יש צורות זהות (עיגולים משמאל, ריבועים מימין). בכל שורה יש צבעים זהים (ירוק למעלה, כחול למטה). לכן הצורה החסרה היא ריבוע כחול." },
                    { type: 'series', question: [ {shape: 'triangle', color: 'purple'}, {shape: 'triangle', color: 'yellow'}, {shape: 'triangle', color: 'red'}, {shape: 'triangle', color: 'purple'} ], options: [ [{shape: 'triangle', color: 'purple'}], [{shape: 'triangle', color: 'yellow'}], [{shape: 'square', color: 'yellow'}], [{shape: 'triangle', color: 'blue'}] ], answer: 1, explanation: "הצורה נשארת קבועה (משולש), ורצף הצבעים חוזר על עצמו: סגול, צהוב, אדום. אחרי סגול יבוא צהוב." },
                    { type: 'series', question: [ {shape: 'square', color: 'black'}, {shape: 'circle', color: 'black'}, {shape: 'triangle', color: 'black'}, '?' ], options: [ [{shape: 'square', color: 'black'}], [{shape: 'circle', color: 'white'}], [{shape: 'triangle', color: 'black'}], [{shape: 'square', color: 'white'}] ], answer: 0, explanation: "הצבע נשאר קבוע (שחור), ורצף הצורות הוא ריבוע, עיגול, משולש. הסדרה מתחילה מחדש, והצורה הבאה היא ריבוע שחור." },
                    { type: 'matrix', question: [ {shape: 'square', color: 'red'}, {shape: 'square', color: 'blue'}, {shape: 'circle', color: 'red'}, '?' ], options: [ [{shape: 'square', color: 'red'}], [{shape: 'circle', color: 'green'}], [{shape: 'square', color: 'blue'}], [{shape: 'circle', color: 'blue'}] ], answer: 3, explanation: "בכל שורה הצורה זהה (ריבועים למעלה, עיגולים למטה). בכל עמודה הצבע זהה (אדום משמאל, כחול מימין). לכן הצורה החסרה היא עיגול כחול." },
                    { type: 'series', question: [ {shape: 'circle', color: 'blue'}, {shape: 'square', color: 'red'}, {shape: 'triangle', color: 'green'} ], options: [ [{shape: 'circle', color: 'blue'}], [{shape: 'square', color: 'red'}], [{shape: 'triangle', color: 'green'}], [{shape: 'circle', color: 'red'}] ], answer: 0, explanation: "הסדרה חוזרת על עצמה ברצף של צורה/צבע: עיגול כחול, ריבוע אדום, משולש ירוק. אחרי המשולש, הרצף מתחיל מחדש." },
                    { type: 'matrix', question: [ {shape: 'square', color: 'yellow'}, {shape: 'square', color: 'yellow', inner:{shape:'circle', color:'black'}}, {shape: 'triangle', color: 'yellow'}, '?' ], options: [ [{shape: 'triangle', color: 'black'}], [{shape: 'triangle', color: 'yellow', inner:{shape:'circle', color:'black'}}], [{shape: 'square', color: 'yellow'}], [{shape: 'triangle', color: 'yellow'}] ], answer: 1, explanation: "החוקיות בכל שורה היא: צורה רגילה, ואז אותה צורה עם עיגול שחור בפנים. לכן אחרי משולש צהוב, יבוא משולש צהוב עם עיגול שחור." },
                    { type: 'series', question: [ {shape: 'triangle', color: 'red'}, {shape: 'triangle', color: 'red'}, {shape: 'triangle', color: 'blue'}, {shape: 'triangle', color: 'blue'}, '?' ], options: [ [{shape: 'square', color: 'blue'}], [{shape: 'triangle', color: 'blue'}], [{shape: 'triangle', color: 'green'}], [{shape: 'triangle', color: 'red'}] ], answer: 3, explanation: "הסדרה מורכבת מזוגות צבעים: שני אדומים, שני כחולים. הצורה הבאה תתחיל זוג חדש של אדומים." },
                    { type: 'series', question: [ {shape: 'circle', color: 'white', inner:{shape:'triangle', color:'black'}}, {shape: 'circle', color: 'white', inner:{shape:'square', color:'black'}}, {shape: 'circle', color: 'white', inner:{shape:'circle', color:'black'}}, '?' ], options: [ [{shape: 'circle', color: 'black'}], [{shape: 'circle', color: 'white', inner:{shape:'triangle', color:'black'}}], [{shape: 'square', color: 'white'}], [{shape: 'circle', color: 'white'}] ], answer: 1, explanation: "המעטפת החיצונית קבועה. הצורה הפנימית משתנה ברצף: משולש, ריבוע, עיגול. הרצף מתחיל מחדש, ולכן הצורה הבאה תהיה משולש." },
                    { type: 'matrix', question: [ {shape: 'square', color: 'purple'}, {shape: 'circle', color: 'green'}, {shape: 'square', color: 'purple'}, '?' ], options: [ [{shape: 'square', color: 'green'}], [{shape: 'circle', color: 'purple'}], [{shape: 'circle', color: 'green'}], [{shape: 'square', color: 'purple'}] ], answer: 2, explanation: "הטורים הם זוגות זהים. הטור הראשון הוא ריבוע סגול, והטור השני הוא עיגול ירוק. החסר הוא עיגול ירוק." },
                    { type: 'series', question: [ {shape: 'square', color: 'black'}, {shape: 'square', color: 'white', inner:{shape:'square', color:'black'}}, {shape: 'square', color: 'black', inner:{shape:'square', color:'white', inner:{shape:'square', color:'black'}}}, '?' ], options: [ [{shape: 'square', color: 'white'}], [{shape: 'square', color: 'black'}], [{shape: 'square', color: 'white', inner:{shape:'square', color:'black', inner:{shape:'square', color:'white'}}}], [{shape: 'square', color: 'white', inner:{shape:'square', color:'black', inner:{shape:'square', color:'white', inner:{shape:'square', color:'black'}}}}] ], answer: 3, explanation: "בכל שלב נוסף ריבוע פנימי בצבע הפוך. השלב הבא יכיל 4 ריבועים לסירוגין." },
                    { type: 'series', question: [ {shape: 'circle', color: 'red'}, {shape: 'circle', color: 'red', inner:{shape:'circle', color:'white'}}, {shape: 'circle', color: 'red'}, '?' ], options: [ [{shape: 'circle', color: 'red', inner:{shape:'circle', color:'white'}}], [{shape: 'circle', color: 'white'}], [{shape: 'square', color: 'red'}], [{shape: 'circle', color: 'red'}] ], answer: 0, explanation: "העיגול הפנימי הלבן מופיע ונעלם לסירוגין. מכיוון שבשלב הקודם הוא נעלם, עכשיו הוא יופיע." },
                    { type: 'matrix', question: [ {shape: 'triangle', color: 'blue'}, {shape: 'square', color: 'blue'}, {shape: 'triangle', color: 'green'}, '?' ], options: [ [{shape: 'circle', color: 'blue'}], [{shape: 'square', color: 'green'}], [{shape: 'triangle', color: 'green'}], [{shape: 'square', color: 'blue'}] ], answer: 1, explanation: "בכל שורה הצבע זהה (כחול למעלה, ירוק למטה). בכל עמודה הצורה זהה (משולש משמאל, ריבוע מימין). לכן החסר הוא ריבוע ירוק." },
                    { type: 'series', question: [ {shape: 'square', color: 'yellow'}, {shape: 'square', color: 'yellow'}, {shape: 'circle', color: 'blue'}, {shape: 'square', color: 'yellow'}, {shape: 'square', color: 'yellow'} ], options: [ [{shape: 'triangle', color: 'yellow'}], [{shape: 'square', color: 'blue'}], [{shape: 'circle', color: 'blue'}], [{shape: 'square', color: 'yellow'}] ], answer: 2, explanation: "הסדרה היא שני ריבועים צהובים ואז עיגול כחול. החוקיות חוזרת על עצמה." },
                    { type: 'series', question: [ {shape: 'triangle', color: 'black'}, {shape: 'square', color: 'black'}, {shape: 'circle', color: 'black'} ], options: [ [{shape: 'triangle', color: 'black'}], [{shape: 'square', color: 'black'}], [{shape: 'circle', color: 'black'}], [{shape: 'triangle', color: 'white'}] ], answer: 0, explanation: "הצבע קבוע (שחור) והצורות מתחלפות בסדר: משולש, ריבוע, עיגול. הרצף מתחיל מחדש עם משולש." },
                ]
            },
            currentCategory: null,
            currentQuestions: [],
            currentQuestionIndex: 0,
            userAnswers: [],
            categoryMap: {
                verbal: { name: "חשיבה מילולית", color: "bg-blue-500" },
                quantitative: { name: "חשיבה כמותית", color: "bg-green-500" },
                figural: { name: "חשיבה צורנית", color: "bg-purple-500" },
            },

            init() {
                this.elements = {
                    welcomeScreen: document.getElementById('welcome-screen'),
                    quizScreen: document.getElementById('quiz-screen'),
                    resultsScreen: document.getElementById('results-screen'),
                    categoryButtons: document.querySelectorAll('.category-btn'),
                    quizCategory: document.getElementById('quiz-category'),
                    questionNumber: document.getElementById('question-number'),
                    totalQuestions: document.getElementById('total-questions'),
                    progressBar: document.getElementById('progress-bar'),
                    questionArea: document.getElementById('question-area'),
                    optionsArea: document.getElementById('options-area'),
                    nextBtn: document.getElementById('next-btn'),
                    backToMenuBtn: document.getElementById('back-to-menu-btn'),
                    scoreDisplay: document.getElementById('score-display'),
                    scorePercentage: document.getElementById('score-percentage'),
                    answersReviewContainer: document.getElementById('answers-review-container'),
                    restartQuizBtn: document.getElementById('restart-quiz-btn'),
                    mainMenuBtn: document.getElementById('main-menu-btn'),
                };
                this.addEventListeners();
            },

            addEventListeners() {
                this.elements.categoryButtons.forEach(btn => btn.addEventListener('click', (e) => this.startQuiz(e.currentTarget.dataset.category)));
                this.elements.nextBtn.addEventListener('click', () => this.nextQuestion());
                this.elements.backToMenuBtn.addEventListener('click', () => this.showWelcomeScreen());
                this.elements.restartQuizBtn.addEventListener('click', () => this.startQuiz(this.currentCategory));
                this.elements.mainMenuBtn.addEventListener('click', () => this.showWelcomeScreen());
            },

            startQuiz(category) {
                this.currentCategory = category;
                this.currentQuestions = this.shuffleArray([...this.questions[category]]);
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                
                this.elements.welcomeScreen.classList.add('hidden');
                this.elements.resultsScreen.classList.add('hidden');
                this.elements.quizScreen.classList.remove('hidden');

                const categoryInfo = this.categoryMap[category];
                this.elements.quizCategory.textContent = categoryInfo.name;
                this.elements.progressBar.className = `h-2.5 rounded-full transition-all duration-500 ${categoryInfo.color}`;

                this.elements.totalQuestions.textContent = this.currentQuestions.length;
                this.displayQuestion();
            },

            displayQuestion() {
                const q = this.currentQuestions[this.currentQuestionIndex];
                this.elements.questionNumber.textContent = this.currentQuestionIndex + 1;
                this.elements.nextBtn.disabled = true;
                
                const progress = ((this.currentQuestionIndex) / this.currentQuestions.length) * 100;
                this.elements.progressBar.style.width = `${progress}%`;
                
                // Render Question and Options
                this.elements.questionArea.innerHTML = this.renderQuestionContent(q);
                this.elements.optionsArea.innerHTML = this.renderOptionsContent(q);

                this.elements.optionsArea.querySelectorAll('.option-btn').forEach((btn, index) => {
                    btn.addEventListener('click', () => this.selectOption(index));
                });
            },

            renderQuestionContent(q) {
                if (this.currentCategory === 'figural') {
                    const items = Array.isArray(q.question) ? q.question : [q.question];
                    let content = '<div class="flex items-center justify-center gap-2 flex-wrap">';
                    items.forEach(item => {
                        if (item === '?') {
                            content += '<div class="w-12 h-12 flex items-center justify-center bg-slate-200 rounded text-2xl font-bold">?</div>';
                        } else {
                            content += this.renderShape(item);
                        }
                    });
                    content += '</div>';
                    return content;
                }
                return `<p class="text-center text-xl font-semibold text-slate-800">${q.question}</p>`;
            },

            renderOptionsContent(q) {
                let optionsHtml = '';
                q.options.forEach((option, index) => {
                    if (this.currentCategory === 'figural') {
                        const items = Array.isArray(option) ? option : [option];
                        let content = '<div class="flex items-center justify-center gap-1">';
                        items.forEach(item => content += this.renderShape(item));
                        content += '</div>';
                        optionsHtml += `<button data-index="${index}" class="option-btn border-2 border-slate-300 p-4 rounded-lg flex items-center justify-center min-h-[80px]">${content}</button>`;
                    } else {
                        optionsHtml += `<button data-index="${index}" class="option-btn border-2 border-slate-300 p-4 rounded-lg text-lg">${option}</button>`;
                    }
                });
                return optionsHtml;
            },

            renderShape(item) {
                let innerShape = '';
                if(item.inner){
                     innerShape = `<div class="absolute shape ${item.inner.shape} flex items-center justify-center" style="background-color: ${item.inner.color}; border-bottom-color: ${item.inner.color};">`
                     if(item.inner.inner) {
                         innerShape += `<div class="absolute shape ${item.inner.inner.shape}" style="background-color: ${item.inner.inner.color}; border-bottom-color: ${item.inner.inner.color};"></div>`
                     }
                     innerShape += `</div>`
                }
                const colorMap = { 'blue': '#3b82f6', 'red': '#ef4444', 'green': '#22c55e', 'yellow': '#eab308', 'purple': '#8b5cf6', 'white': '#ffffff', 'black': '#000000' };
                const bgColor = colorMap[item.color] || item.color;

                if (item.shape === 'triangle') {
                    return `<div class="relative shape triangle flex items-center justify-center" style="border-bottom-color: ${bgColor};">${innerShape}</div>`;
                }
                return `<div class="relative shape ${item.shape} flex items-center justify-center" style="background-color: ${bgColor};">${innerShape}</div>`;
            },
            
            selectOption(index) {
                this.userAnswers[this.currentQuestionIndex] = index;
                document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
                document.querySelector(`.option-btn[data-index='${index}']`).classList.add('selected');
                this.elements.nextBtn.disabled = false;
            },
            
            nextQuestion() {
                this.currentQuestionIndex++;
                if (this.currentQuestionIndex < this.currentQuestions.length) {
                    this.displayQuestion();
                } else {
                    this.showResults();
                }
            },
            
            showResults() {
                this.elements.quizScreen.classList.add('hidden');
                this.elements.resultsScreen.classList.remove('hidden');

                let correctAnswers = 0;
                this.elements.answersReviewContainer.innerHTML = '';

                this.currentQuestions.forEach((q, index) => {
                    const userAnswerIndex = this.userAnswers[index];
                    const isCorrect = userAnswerIndex === q.answer;
                    if (isCorrect) correctAnswers++;

                    const questionContent = this.currentCategory === 'figural' 
                        ? 'שאלה צורנית ' + (index+1) 
                        : `"${q.question}"`;

                    const userAnswerText = (userAnswerIndex === undefined) ? 'לא נענתה' : (this.currentCategory === 'figural' 
                        ? `בחירה ${userAnswerIndex + 1}`
                        : `"${q.options[userAnswerIndex]}"`);

                    const correctAnswerText = this.currentCategory === 'figural' 
                        ? `בחירה ${q.answer + 1}`
                        : `"${q.options[q.answer]}"`;
                    
                    this.elements.answersReviewContainer.innerHTML += `
                        <div class="p-3 rounded-lg ${isCorrect ? 'bg-green-50' : 'bg-red-50'}">
                            <p class="font-semibold text-slate-800">${index + 1}. ${questionContent}</p>
                            <p class="text-sm font-semibold ${isCorrect ? 'text-green-800' : 'text-red-800'}">
                                <span class="font-normal">התשובה שלך:</span> ${userAnswerText} ${isCorrect ? '✔️' : '❌'}
                            </p>
                            ${!isCorrect ? `
                                <div class="mt-2 pt-2 border-t border-red-200">
                                    <p class="text-sm font-semibold text-slate-700"><span class="font-normal">התשובה הנכונה:</span> ${correctAnswerText}</p>
                                    <p class="text-xs text-slate-600 mt-1"><strong>הסבר:</strong> ${q.explanation}</p>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

                this.elements.scoreDisplay.textContent = `${correctAnswers}/${this.currentQuestions.length}`;
                const percentage = this.currentQuestions.length > 0 ? Math.round((correctAnswers / this.currentQuestions.length) * 100) : 0;
                this.elements.scorePercentage.textContent = `${percentage}% הצלחה`;
            },

            showWelcomeScreen() {
                this.elements.quizScreen.classList.add('hidden');
                this.elements.resultsScreen.classList.add('hidden');
                this.elements.welcomeScreen.classList.remove('hidden');
            },

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
        };

        app.init();
    </script>
</body>
</html>

