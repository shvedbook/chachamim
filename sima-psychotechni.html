<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מבחן פסיכוטכני - בקר/ית ציות (מיטב)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Assistant', sans-serif;
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .option-btn {
            transition: all 0.2s ease-in-out;
        }
        .option-btn.selected {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .option-btn.correct {
            background-color: #16a34a !important;
            color: white !important;
            border-color: #16a34a !important;
        }
        .option-btn.incorrect {
            background-color: #dc2626 !important;
            color: white !important;
            border-color: #dc2626 !important;
        }
        /* Style for Accuracy/Data Checking questions */
        .data-comparison span {
            font-family: 'Courier New', Courier, monospace;
            letter-spacing: 1px;
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <div id="app" class="w-full max-w-4xl mx-auto">
        
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="bg-white p-8 rounded-2xl shadow-xl text-center border-t-8 border-blue-600">
            <h1 class="text-4xl font-bold text-slate-800 mb-2">מבחן כישורים - בקרת ציות</h1>
            <h2 class="text-xl text-blue-600 font-semibold mb-6">סימולציה מותאמת למיונים בבית השקעות</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 text-right">
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <h3 class="font-bold text-blue-800 mb-2">📊 חשיבה כמותית-פיננסית</h3>
                    <p class="text-sm text-slate-600">חישובי תשואות, עמלות, אחוזים והבנת טבלאות. קריטי לבקרת דו"חות.</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg border border-purple-100">
                    <h3 class="font-bold text-purple-800 mb-2">⚖️ לוגיקה מילולית ורגולציה</h3>
                    <p class="text-sm text-slate-600">הסקת מסקנות מטקסטים מורכבים וכללים רגולטוריים (הבנת הנקרא ברמה גבוהה).</p>
                </div>
                <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                    <h3 class="font-bold text-orange-800 mb-2">🎯 דיוק וזיהוי שגיאות</h3>
                    <p class="text-sm text-slate-600">איתור חריגות בנתונים, השוואת מחרוזות ומספרים. הלב של עבודת הבקר.</p>
                </div>
            </div>

            <p class="text-slate-600 mb-8 font-medium">
                המבחן כולל 30 שאלות עם טיימר לכל שאלה. הציון משקלל דיוק ומהירות.
            </p>
            
            <div class="flex justify-center gap-4">
                <button onclick="app.startQuiz('quantitative')" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 shadow-lg transform hover:-translate-y-1 transition-all">
                    התחל: כמותי
                </button>
                <button onclick="app.startQuiz('verbal')" class="bg-purple-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-purple-700 shadow-lg transform hover:-translate-y-1 transition-all">
                    התחל: מילולי
                </button>
                <button onclick="app.startQuiz('accuracy')" class="bg-orange-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-orange-700 shadow-lg transform hover:-translate-y-1 transition-all">
                    התחל: דיוק
                </button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg relative overflow-hidden">
                <!-- Header -->
                <div class="flex justify-between items-start mb-6 border-b pb-4">
                    <div>
                        <span id="category-badge" class="inline-block px-3 py-1 rounded-full text-sm font-bold mb-2"></span>
                        <div class="text-slate-500 text-sm">שאלה <span id="q-current">1</span> מתוך <span id="q-total">10</span></div>
                    </div>
                    <div class="flex flex-col items-end">
                        <div class="flex items-center gap-2 text-2xl font-mono font-bold" id="timer-display">
                            <span id="timer-val">00:00</span>
                            <span>⏱️</span>
                        </div>
                        <div class="w-32 h-1 bg-gray-200 rounded mt-1 overflow-hidden">
                            <div id="timer-bar" class="h-full bg-blue-500 transition-all duration-1000" style="width: 100%"></div>
                        </div>
                    </div>
                </div>

                <!-- Question Area -->
                <div class="mb-8">
                    <div id="question-content" class="text-xl font-medium text-slate-800 mb-6 leading-relaxed min-h-[80px]"></div>
                    
                    <!-- Options -->
                    <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Buttons injected via JS -->
                    </div>
                </div>

                <!-- Feedback Area (Hidden initially) -->
                <div id="feedback-area" class="hidden mt-6 p-4 rounded-lg bg-gray-50 border border-gray-200 animation-fade-in">
                    <h4 id="feedback-title" class="font-bold text-lg mb-2"></h4>
                    <p id="feedback-text" class="text-slate-700"></p>
                    <div class="mt-4 flex justify-end">
                        <button id="next-btn" class="bg-slate-800 text-white px-6 py-2 rounded hover:bg-slate-900 transition-colors">
                            המשך לשאלה הבאה
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden">
            <div class="bg-white p-8 rounded-2xl shadow-lg text-center">
                <div class="mb-6 inline-block p-4 rounded-full bg-blue-50">
                    <span class="text-4xl">🏆</span>
                </div>
                <h2 class="text-3xl font-bold text-slate-800 mb-2">סיכום ביצועים</h2>
                <p class="text-slate-500 mb-8">קטגוריה: <span id="result-category" class="font-bold"></span></p>

                <div class="grid grid-cols-2 gap-4 mb-8 max-w-md mx-auto">
                    <div class="p-4 bg-green-50 rounded-xl border border-green-100">
                        <div class="text-3xl font-bold text-green-600" id="final-score">0</div>
                        <div class="text-sm text-green-800">ציון משוקלל</div>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-xl border border-blue-100">
                        <div class="text-3xl font-bold text-blue-600" id="final-correct">0/10</div>
                        <div class="text-sm text-blue-800">תשובות נכונות</div>
                    </div>
                </div>

                <div id="performance-feedback" class="text-right bg-slate-50 p-6 rounded-lg mb-8 text-slate-700"></div>

                <button onclick="location.reload()" class="bg-slate-800 text-white font-bold py-3 px-8 rounded-lg hover:bg-slate-900 shadow-lg">
                    חזרה לתפריט הראשי
                </button>
            </div>
        </div>

    </div>

    <script>
        const app = {
            state: {
                currentCategory: null,
                currentQuestionIdx: 0,
                score: 0,
                timer: null,
                timeLeft: 0,
                questions: []
            },

            // Database of Questions
            data: {
                quantitative: [
                    {
                        q: "קרן נאמנות השיגה תשואה של 12% בשנה הראשונה, ו-10%- (הפסד) בשנה השנייה. מהי התשואה המצטברת המקורבת לשנתיים?",
                        opts: ["2%", "0.8%", "1%", "2%-"],
                        ans: 1, // 1.12 * 0.9 = 1.008 -> 0.8%
                        time: 60,
                        exp: "<strong>חישוב:</strong> מתחילים עם 100. אחרי שנה: 112. ירידה של 10% מ-112 היא 11.2. <br>112 - 11.2 = 100.8. הרווח הוא 0.8%. <br><strong>טיפ לבקר:</strong> הפסד באחוז זהה דורש עלייה באחוז גבוה יותר כדי לחזור לקרן."
                    },
                    {
                        q: "דמי הניהול בקרן הם 0.5% מהצבירה. אם הצבירה היא 2,400,000 ש\"ח, מהם דמי הניהול החודשיים?",
                        opts: ["1,000 ש\"ח", "12,000 ש\"ח", "1,200 ש\"ח", "100 ש\"ח"],
                        ans: 0, 
                        time: 45,
                        exp: "<strong>חישוב:</strong> 0.5% מ-2.4 מיליון הם 12,000 ש\"ח (שנתי). <br>לחודש נחלק ב-12: 12,000 / 12 = 1,000 ש\"ח."
                    },
                    {
                        q: "מניית 'טכנו-על' ירדה ב-20%. בכמה אחוזים עליה לעלות כעת כדי לחזור למחירה המקורי?",
                        opts: ["20%", "25%", "30%", "33%"],
                        ans: 1,
                        time: 40,
                        exp: "<strong>היגיון:</strong> אם מניה ירדה מ-100 ל-80, היא צריכה לעלות ב-20 נקודות. <br>20 מתוך 80 הם רבע, כלומר 25%."
                    },
                    {
                        q: "בתיק השקעות היחס בין אג\"ח למניות הוא 3:2. סך התיק הוא 500,000 ש\"ח. כמה כסף מושקע במניות?",
                        opts: ["200,000", "300,000", "150,000", "250,000"],
                        ans: 0, // מניות זה החלק הקטן (2 מתוך 5)
                        time: 50,
                        exp: "<strong>חישוב:</strong> סך החלקים הוא 2+3=5. שווי כל חלק: 500,000/5 = 100,000. <br>מניות הן 2 חלקים, לכן 200,000. שימו לב לסדר ביחס (אג\"ח:מניות)."
                    },
                    {
                        q: "חברה דיווחה על רווח תפעולי של 4 מיליון, המהווים 16% מההכנסות. מהן ההכנסות?",
                        opts: ["20 מיליון", "25 מיליון", "64 מיליון", "30 מיליון"],
                        ans: 1,
                        time: 60,
                        exp: "<strong>חישוב:</strong> אם 4 הם 16%, אז 1 מיליון הוא 4%. <br>כדי להגיע ל-100% נכפיל ב-25 (כי 4*25=100). 1 מיליון * 25 = 25 מיליון."
                    },
                    {
                        q: "הרגולציה מגבילה חשיפה למנפיק בודד ל-15%. בתיק של 10 מיליון ש\"ח, הושקעו 1.2 מיליון במנפיק א' ו-0.4 מיליון נוספים דרך חברה בת שלו. האם יש חריגה?",
                        opts: ["כן, סה\"כ 16%", "לא, סה\"כ 12%", "לא, החשיפה היא 1.6%", "כן, החשיפה היא 1.8 מיליון"],
                        ans: 0,
                        time: 50,
                        exp: "<strong>ניתוח:</strong> סה\"כ חשיפה: 1.2 + 0.4 = 1.6 מיליון. <br>1.6 מתוך 10 הם 16%. המגבלה היא 15%, לכן יש חריגה."
                    },
                    {
                        q: "לקוח משלם עמלת קנייה של 0.1%. הוא ביצע 5 עסקאות שכל אחת בנפח 20,000 ש\"ח. כמה עמלה שילם סה\"כ?",
                        opts: ["10 ש\"ח", "20 ש\"ח", "100 ש\"ח", "50 ש\"ח"],
                        ans: 2,
                        time: 45,
                        exp: "<strong>חישוב:</strong> נפח כולל: 5 * 20,000 = 100,000. <br>0.1% מ-100,000 הם 100 ש\"ח."
                    },
                    {
                        q: "אם המדד עלה ב-1.5% והקרן עלתה ב-1.2%, מהו פער התשואה (Tracking Error) בנקודות בסיס?",
                        opts: ["30 נקודות", "3 נקודות", "0.3 נקודות", "300 נקודות"],
                        ans: 0,
                        time: 30,
                        exp: "<strong>הסבר:</strong> ההפרש הוא 0.3%. כל 1% הוא 100 נקודות בסיס. <br>לכן 0.3% הם 30 נקודות בסיס."
                    },
                    {
                        q: "נתון: (A > B) וגם (B > C). איזו טענה נכונה בהכרח לגבי תשואות?",
                        opts: ["A תמיד תהיה התשואה הגבוהה ביותר", "C יכולה להיות שווה ל-A", "הממוצע של A ו-C גדול מ-B", "לא ניתן לדעת"],
                        ans: 0,
                        time: 30,
                        exp: "<strong>לוגיקה:</strong> לפי חוק הטרנזיטיביות, אם A גדול מ-B ו-B גדול מ-C, אז A בהכרח גדול מ-C וגם מ-B. לכן A הגבוה ביותר."
                    },
                    {
                        q: "חברה א' נסחרת בשווי 200 מיליון. חברה ב' נסחרת בשווי 50 מיליון. המניה של ב' עלתה ב-100%. מה היחס החדש בין שווי א' לשווי ב'?",
                        opts: ["2:1", "1:1", "4:1", "3:1"],
                        ans: 0,
                        time: 45,
                        exp: "<strong>חישוב:</strong> חברה ב' עלתה ב-100%, כלומר שוויה הוכפל ל-100 מיליון. <br>היחס בין 200 ל-100 הוא 2:1."
                    }
                ],
                verbal: [
                    {
                        q: "נוהל איסור הלבנת הון קובע: 'אין לבצע הפקדה במזומן מעל 10,000 ש\"ח ללא זיהוי מקור הכספים'. לקוח מבקש להפקיד 9,500 ש\"ח היום ו-2,000 ש\"ח מחר. מה עליך לעשות?",
                        opts: ["לאשר, כי כל הפקדה בנפרד נמוכה מהתקרה", "לסרב ולדרוש זיהוי מקור, שכן זהו פיצול הפקדות חשוד (Smurfing)", "לאשר רק את ההפקדה הראשונה", "לדווח למשטרה מיד"],
                        ans: 1,
                        time: 45,
                        exp: "<strong>לוגיקה רגולטורית:</strong> מטרת הנוהל היא למנוע הלבנה. פיצול סכומים כדי לעקוף את הסף הוא דפוס מוכר ('Smurfing') ודורש התייחסות כאילו מדובר בסכום המצטבר."
                    },
                    {
                        q: "הנחה א': כל היועצים הפנסיוניים חייבים ברישיון. הנחה ב': דני עובד במיטב. מסקנה: דני הוא יועץ פנסיוני בעל רישיון. האם המסקנה תקפה?",
                        opts: ["כן, בהכרח", "לא, ייתכן שדני עובד בתפקיד אחר", "כן, אבל רק אם הוא עוסק בשיווק", "לא, ייתכן שדני יועץ ללא רישיון"],
                        ans: 1,
                        time: 30,
                        exp: "<strong>לוגיקה פורמלית:</strong> העובדה שדני עובד במיטב לא אומרת שהוא יועץ. ייתכן שהוא איש IT או בקר ציות. לכן המסקנה לא נובעת מההנחות."
                    },
                    {
                        q: "משמעות המונח 'חומות סיניות' (Chinese Walls) בבית השקעות היא:",
                        opts: ["הגנה מפני התקפות סייבר מסין", "הפרדה מוחלטת בין מחלקות למניעת ניגוד עניינים ומעבר מידע פנים", "איסור על השקעות במזרח הרחוק", "מחסום פיזי בכניסה לחדר המסחר"],
                        ans: 1,
                        time: 30,
                        exp: "<strong>ידע מקצועי:</strong> זהו מונח בסיסי בציות. מדובר בהפרדת מידע (למשל בין הנוסטרו לבין ניהול תיקי לקוחות) כדי למנוע ניגוד עניינים."
                    },
                    {
                        q: "השלם את המשפט: 'הבקר זיהה חריגה בדו\"ח, ___ הוא עצר את הפעילות ___ שהיה מדובר בלקוח אסטרטגי'.",
                        opts: ["ולכן / למרות", "אולם / מפני", "לפיכך / בגלל", "אך / כיוון"],
                        ans: 0,
                        time: 35,
                        exp: "<strong>הבנת הנקרא:</strong> הקשר הלוגי הוא של סיבה ותוצאה (זיהה -> עצר) ושל ניגוד (עצר למרות חשיבות הלקוח, מה שמעיד על יושרה מקצועית)."
                    },
                    {
                        q: "איזה משפט מייצג את הגישה המחמירה ביותר לניהול סיכונים?",
                        opts: ["יש לקחת סיכונים מחושבים כדי להשיג תשואה", "כל ספק סביר לגבי חוקיות הפעולה מחייב את עצירתה המיידית", "ניתן לאשר חריגות קטנות אם המנהל מאשר", "הרגולציה היא המלצה בלבד"],
                        ans: 1,
                        time: 30,
                        exp: "<strong>גישה מקצועית:</strong> בקרת ציות דורשת שמרנות. המשפט השני מייצג מדיניות 'אפס סובלנות' לסיכוני ציות."
                    },
                    {
                        q: "נתון: רק מורשי חתימה יכולים לאשר העברות כספים. יוסי אישר העברת כספים. מסקנה:",
                        opts: ["יוסי הוא מורשה חתימה", "ההעברה בוצעה בהצלחה", "יוסי עבר עבירה", "לא ניתן לדעת"],
                        ans: 0,
                        time: 25,
                        exp: "<strong>לוגיקה:</strong> אם התנאי להעברה הוא היותך מורשה, ויוסי ביצע זאת (חוקית), הוא חייב להיות מורשה. (הערה: אם הוא עשה זאת בניגוד לנהלים זה סיפור אחר, אך בלוגיקה מניחים שהכלל מתקיים)."
                    },
                    {
                        q: "מצא את יוצא הדופן: הרצה, שימוש במידע פנים, פיזור השקעות, הונאת פונזי.",
                        opts: ["הרצה", "שימוש במידע פנים", "פיזור השקעות", "הונאת פונזי"],
                        ans: 2,
                        time: 25,
                        exp: "<strong>סיווג מושגים:</strong> שלושת המושגים האחרים הם עבירות פליליות/הונאות בשוק ההון. פיזור השקעות הוא כלי לגיטימי וחיובי לניהול סיכונים."
                    },
                    {
                        q: "בטקסט רגולטורי כתוב: 'החברה תמנה מבקר פנים, זולת אם היא חברה פרטית שמחזורה נמוך מ-X'. חברת 'אלפא' לא מינתה מבקר פנים. מה נכון?",
                        opts: ["אלפא עוברת על החוק", "אלפא היא בהכרח חברה ציבורית", "ייתכן שאלפא היא חברה פרטית עם מחזור נמוך", "אלפא פטורה מכל רגולציה"],
                        ans: 2,
                        time: 40,
                        exp: "<strong>הבנת הנקרא:</strong> המילה 'זולת' (אלא אם כן) יוצרת חריג. אם לא מונה מבקר, ייתכן שהחברה נופלת תחת החריג (פרטית + מחזור נמוך)."
                    },
                    {
                        q: "אנלוגיה: בקר : נהלים",
                        opts: ["שוטר : חוקים", "רופא : חולים", "מורה : תלמידים", "נהג : מכונית"],
                        ans: 0,
                        time: 25,
                        exp: "<strong>אנלוגיה:</strong> התפקיד של בקר הוא לאכוף/לשמור על הנהלים. התפקיד של שוטר הוא לאכוף/לשמור על החוקים. היחס הוא 'בעל תפקיד : מערכת הכללים עליה הוא מופקד'."
                    },
                    {
                        q: "משמעות הביטוי 'Due Diligence' היא:",
                        opts: ["רשלנות פושעת", "בדיקת נאותות", "חובת הדיווח", "תשלום דיבידנד"],
                        ans: 1,
                        time: 20,
                        exp: "<strong>אנגלית מקצועית:</strong> מושג יסוד. בדיקה מעמיקה לפני ביצוע עסקה או התקשרות."
                    }
                ],
                accuracy: [
                    {
                        q: "מצא את השורה בה המספרים <strong>אינם</strong> זהים:",
                        opts: [
                            "<span class='font-mono'>89547120 | 89547120</span>",
                            "<span class='font-mono'>36985214 | 36985214</span>",
                            "<span class='font-mono'>74125896 | 74125986</span>",
                            "<span class='font-mono'>12365478 | 12365478</span>"
                        ],
                        ans: 2, // 896 vs 986 at end
                        time: 20,
                        exp: "<strong>זיהוי שגיאה:</strong> באפשרות השלישית, הספרות האחרונות הוחלפו (896 לעומת 986). בקר חייב לזהות שיכולים כאלה במספרי חשבון/ת.ז."
                    },
                    {
                        q: "השווה בין שתי המחרוזות: <br> 'Meitav Dash Investments Ltd' <br> 'Meitav Dash Investmemts Ltd'",
                        opts: ["המחרוזות זהות", "יש הבדל באות אחת", "יש הבדל בשתי אותיות", "המילה הראשונה שונה"],
                        ans: 1, // m vs n in Investments
                        time: 20,
                        exp: "<strong>דיוק בפרטים:</strong> במחרוזת השנייה כתוב Investme<strong>m</strong>ts במקום Investme<strong>n</strong>ts."
                    },
                    {
                        q: "איזה מהקודים הבאים שונה מהאחרים במבנהו?",
                        opts: ["AB-123-CD", "XY-789-ZP", "MN-456-RT", "JK-55-LM"],
                        ans: 3,
                        time: 15,
                        exp: "<strong>זיהוי תבנית:</strong> כל הקודים הם במבנה: 2 אותיות, 3 ספרות, 2 אותיות. האחרון מכיל רק 2 ספרות באמצע."
                    },
                    {
                        q: "אם A=1, B=2, C=3... מהו סכום האותיות במילה RISK?",
                        opts: ["50", "63", "57", "45"],
                        ans: 1, // R=18, I=9, S=19, K=11 -> 18+9+19+11 = 57. Wait. Let's recalc. 
                        // R(18) + I(9) = 27. 27 + S(19) = 46. 46 + K(11) = 57.
                        // My mental calc was fast. Let's verify alphabet.
                        // A1 B2 C3 D4 E5 F6 G7 H8 I9 J10 K11 L12 M13 N14 O15 P16 Q17 R18 S19
                        // Answer is 57.
                        time: 45,
                        exp: "<strong>תשומת לב וחישוב:</strong> R(18) + I(9) + S(19) + K(11) = 57. בודק יכולת קידוד וחישוב מהיר."
                    },
                    {
                        q: "סמן את התאריך התקין מבחינת פורמט DD/MM/YYYY:",
                        opts: ["31/02/2023", "12/13/2023", "29/02/2024", "31/04/2023"],
                        ans: 2,
                        time: 30,
                        exp: "<strong>בקרת תקינות:</strong> <br>1. אין 31 בפברואר. <br>2. אין חודש 13. <br>3. 2024 היא שנה מעוברת ולכן 29 בפברואר תקין. <br>4. באפריל יש רק 30 ימים."
                    },
                    {
                        q: "השווה את רשימת המוטבים. איזה שם מופיע בשתי הרשימות?",
                        opts: ["רשימה א: כהן, לוי, אברהם | רשימה ב: מזרחי, אברהמי, כהנוביץ", "אף שם לא זהה", "כהן", "אברהם"],
                        ans: 1, // אברהם vs אברהמי, כהן vs כהנוביץ
                        time: 25,
                        exp: "<strong>אימות נתונים:</strong> השמות דומים אך לא זהים (כהן/כהנוביץ, אברהם/אברהמי). בבקרת סנקציות זה קריטי."
                    },
                    {
                        q: "כמה פעמים מופיעה הספרה 9 ברצף הבא: 91992398495919",
                        opts: ["5", "6", "7", "8"],
                        ans: 2, // 9, 9, 9, 9, 9, 9, 9 - count carefully
                        // 9 1 9 9 2 3 9 8 4 9 5 9 1 9
                        // 1 2 3   4     5   6   7
                        time: 25,
                        exp: "<strong>ספירה ומיקוד:</strong> נדרש לספור את המופעים במדויק תחת לחץ זמן."
                    },
                    {
                        q: "איזה מספר משלים את הסדרה? 100, 95, 85, 70, ___",
                        opts: ["50", "55", "60", "45"],
                        ans: 0,
                        time: 35,
                        exp: "<strong>זיהוי מגמה:</strong> ההפרשים הם: 5-, 10-, 15-. ההפרש הבא צריך להיות 20-. <br>70 - 20 = 50."
                    },
                    {
                        q: "מצא את הזוג ההפוך:",
                        opts: ["הכנסה / הוצאה", "נכס / התחייבות", "רווח / הפסד", "אשראי / הלוואה"],
                        ans: 3,
                        time: 20,
                        exp: "<strong>הבנה מושגית:</strong> אשראי והלוואה הם מילים נרדפות או צדדים משלימים של אותה פעולה, לא הפכים כמו שאר הזוגות."
                    },
                    {
                        q: "אם קוד האישור חייב להכיל אות גדולה, אות קטנה ומספר, איזה קוד תקין?",
                        opts: ["Pass123", "password123", "PASS123", "PassWord"],
                        ans: 0,
                        time: 20,
                        exp: "<strong>אימות חוקיות:</strong> רק Pass123 מכיל גם גדולה (P), גם קטנות (ass) וגם מספרים."
                    }
                ]
            },

            // Logic Functions
            startQuiz(category) {
                this.state.currentCategory = category;
                this.state.currentQuestionIdx = 0;
                this.state.score = 0;
                this.state.questions = this.shuffle(this.data[category]); // Shuffle questions
                
                // Colors and Titles
                const colors = {
                    quantitative: 'bg-blue-600',
                    verbal: 'bg-purple-600',
                    accuracy: 'bg-orange-600'
                };
                const titles = {
                    quantitative: 'חשיבה כמותית',
                    verbal: 'חשיבה מילולית',
                    accuracy: 'דיוק ותפיסה'
                };

                document.getElementById('category-badge').className = `inline-block px-3 py-1 rounded-full text-white text-sm font-bold mb-2 ${colors[category]}`;
                document.getElementById('category-badge').innerText = titles[category];
                document.getElementById('timer-bar').className = `h-full transition-all duration-1000 ${colors[category]}`;

                document.getElementById('welcome-screen').classList.add('hidden');
                document.getElementById('quiz-screen').classList.remove('hidden');
                
                this.renderQuestion();
            },

            renderQuestion() {
                const q = this.state.questions[this.state.currentQuestionIdx];
                
                // Update UI
                document.getElementById('q-current').innerText = this.state.currentQuestionIdx + 1;
                document.getElementById('q-total').innerText = this.state.questions.length;
                document.getElementById('question-content').innerHTML = q.q;
                
                // Hide feedback
                document.getElementById('feedback-area').classList.add('hidden');
                document.getElementById('options-grid').innerHTML = '';

                // Generate Options
                q.opts.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.innerHTML = opt; // Using innerHTML for formatting (span, etc.)
                    btn.className = "option-btn border-2 border-slate-200 p-4 rounded-xl text-lg font-medium hover:bg-slate-50 hover:border-slate-300 text-slate-700 w-full text-right transition-all";
                    btn.onclick = () => this.handleAnswer(idx, btn);
                    document.getElementById('options-grid').appendChild(btn);
                });

                // Start Timer
                this.startTimer(q.time);
            },

            startTimer(seconds) {
                if (this.state.timer) clearInterval(this.state.timer);
                this.state.timeLeft = seconds;
                
                const updateDisplay = () => {
                    const minutes = Math.floor(this.state.timeLeft / 60);
                    const secs = this.state.timeLeft % 60;
                    document.getElementById('timer-val').innerText = 
                        `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    
                    // Bar width
                    const percent = (this.state.timeLeft / seconds) * 100;
                    document.getElementById('timer-bar').style.width = `${percent}%`;
                };

                updateDisplay();

                this.state.timer = setInterval(() => {
                    this.state.timeLeft--;
                    updateDisplay();
                    
                    if (this.state.timeLeft <= 0) {
                        clearInterval(this.state.timer);
                        this.handleTimeout();
                    }
                }, 1000);
            },

            handleAnswer(selectedIdx, btnElement) {
                if (this.state.timer) clearInterval(this.state.timer);
                
                const q = this.state.questions[this.state.currentQuestionIdx];
                const isCorrect = selectedIdx === q.ans;
                const buttons = document.querySelectorAll('.option-btn');

                // Disable all buttons
                buttons.forEach(b => b.disabled = true);

                // Visual Feedback
                if (isCorrect) {
                    btnElement.classList.add('correct');
                    this.state.score++;
                } else {
                    btnElement.classList.add('incorrect');
                    // Show correct one
                    buttons[q.ans].classList.add('correct', 'border-green-500');
                }

                this.showFeedback(isCorrect, q.exp);
            },

            handleTimeout() {
                const q = this.state.questions[this.state.currentQuestionIdx];
                const buttons = document.querySelectorAll('.option-btn');
                buttons.forEach(b => b.disabled = true);
                
                // Show correct one
                buttons[q.ans].classList.add('correct');
                
                this.showFeedback(false, "<strong>הזמן עבר!</strong><br>" + q.exp);
            },

            showFeedback(isCorrect, explanation) {
                const fbArea = document.getElementById('feedback-area');
                const fbTitle = document.getElementById('feedback-title');
                const fbText = document.getElementById('feedback-text');
                const nextBtn = document.getElementById('next-btn');

                fbArea.classList.remove('hidden');
                
                if (isCorrect) {
                    fbTitle.innerHTML = "✅ תשובה נכונה";
                    fbTitle.className = "font-bold text-lg mb-2 text-green-700";
                    fbArea.className = "mt-6 p-4 rounded-lg bg-green-50 border border-green-200 animation-fade-in";
                } else {
                    fbTitle.innerHTML = "❌ טעות / נגמר הזמן";
                    fbTitle.className = "font-bold text-lg mb-2 text-red-700";
                    fbArea.className = "mt-6 p-4 rounded-lg bg-red-50 border border-red-200 animation-fade-in";
                }

                fbText.innerHTML = explanation;

                nextBtn.onclick = () => {
                    this.state.currentQuestionIdx++;
                    if (this.state.currentQuestionIdx < this.state.questions.length) {
                        this.renderQuestion();
                    } else {
                        this.showResults();
                    }
                };
            },

            showResults() {
                document.getElementById('quiz-screen').classList.add('hidden');
                document.getElementById('results-screen').classList.remove('hidden');

                const score = this.state.score;
                const total = this.state.questions.length;
                const percent = Math.round((score / total) * 100);

                const categories = {
                    quantitative: 'חשיבה כמותית',
                    verbal: 'חשיבה מילולית',
                    accuracy: 'דיוק ותפיסה'
                };

                document.getElementById('result-category').innerText = categories[this.state.currentCategory];
                document.getElementById('final-score').innerText = percent;
                document.getElementById('final-correct').innerText = `${score}/${total}`;

                let feedback = "";
                if (percent >= 80) feedback = "מצוין! יש לך את הכישורים הנדרשים לתפקיד בקר. אתה חד, מדויק ומהיר.";
                else if (percent >= 60) feedback = "טוב, אבל יש מקום לשיפור. כדאי לתרגל עוד את התחום הזה, במיוחד תחת לחץ זמן.";
                else feedback = "התוצאה נמוכה מהנדרש. בתפקידי בקרה נדרש דיוק גבוה יותר. מומלץ לתרגל יסודות.";

                document.getElementById('performance-feedback').innerText = feedback;
            },

            shuffle(array) {
                // Fisher-Yates shuffle
                let currentIndex = array.length, randomIndex;
                // Create a copy to avoid mutating original data
                let newArr = [...array];

                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [newArr[currentIndex], newArr[randomIndex]] = [newArr[randomIndex], newArr[currentIndex]];
                }
                return newArr;
            }
        };
    </script>
</body>
</html>
